{"ast":null,"code":"import { takeUntil } from \"rxjs/operators\";\nimport { Subject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/player.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../../shared/components/header/header.component\";\nconst _c0 = [\"swiper\"];\nconst _c1 = [\"bottomSheet\"];\nconst _c2 = [\"scroll\"];\nexport let NowPlayingComponent = /*#__PURE__*/(() => {\n  class NowPlayingComponent {\n    constructor(playerService, location, router) {\n      this.playerService = playerService;\n      this.location = location;\n      this.router = router;\n      this.tracks = [];\n      this.track = {};\n      this.progress = 0;\n      this.volume = (parseFloat(localStorage.getItem(\"volume\")) || 1) * 100;\n      this.playing = false;\n      this.config = {\n        virtual: true,\n        slidesPerView: 1,\n        spaceBetween: 0\n      };\n      this.lyrics = false;\n      this.currentTime = 0;\n      this.buffering = false;\n      this.buffer = 0;\n      this.duration = 0;\n      this.loading = false;\n      this.options = {\n        maxHeight: \"80vh\"\n      };\n      this.destroy = new Subject();\n    }\n\n    ngOnInit() {\n      this.playerService.$playing.pipe(takeUntil(this.destroy)).subscribe(playing => {\n        this.playing = playing;\n      });\n      this.playerService.$buffering.pipe(takeUntil(this.destroy)).subscribe(buffering => {\n        this.buffering = buffering;\n      });\n      this.playerService.$buffer.pipe(takeUntil(this.destroy)).subscribe(buffer => {\n        this.buffer = buffer;\n      });\n      this.playerService.$volume.pipe(takeUntil(this.destroy)).subscribe(volume => {\n        this.volume = volume * 100;\n      });\n      this.playerService.$progress.pipe(takeUntil(this.destroy)).subscribe(num => {\n        this.progress = num;\n        this.currentTime = this.playerService.audio.currentTime;\n      });\n      this.playerService.$queue.pipe(takeUntil(this.destroy)).subscribe(tracks => {\n        this.tracks = tracks;\n\n        if (!this.config.initialSlide) {\n          this.config.initialSlide = this.playerService.index;\n        }\n\n        this.duration = 0;\n        this.tracks.map(track => {\n          if (track.duration) {\n            this.duration += track.duration;\n          }\n        });\n      });\n      this.playerService.$track.pipe(takeUntil(this.destroy)).subscribe(track => {\n        this.track = track;\n\n        if (this.track.progress) {\n          this.progress = this.track.progress;\n        }\n\n        this.lyrics = false;\n\n        if (this.swiper) {\n          this.swiper.setIndex(this.playerService.index);\n        }\n      });\n    }\n\n    onSlideChange(e) {\n      if (e.activeIndex !== this.playerService.index) {\n        this.playerService.onPlay(this.tracks[e.activeIndex]);\n      }\n    }\n\n    onProgress(e) {\n      this.playerService.onSeek(e);\n    }\n\n    onClear() {\n      this.playerService.clear();\n    }\n\n    onClose() {\n      this.location.back(); // this.modal.close();\n    }\n\n    onPlaylist() {\n      this.playerService.onAddToPlaylist(this.track);\n    }\n\n    onVolume(e) {\n      const value = 100 - e * 100;\n      const volume = 1 - value / 100;\n\n      if (volume >= 0 && volume <= 1) {\n        this.playerService.onVolume(volume);\n      }\n\n      this.volume = 100 - value;\n    }\n\n    onLike(e) {\n      this.playerService.onLike(this.track._id).subscribe(() => {\n        this.track.liked = !this.track.liked;\n        /*this.interfaceService.notify(`${this.track.name} ${this.track.liked ? \"added to favourites\" : \"removed from favourites\"}`, {\n            timeout: 3000,\n        });*/\n      });\n    }\n\n    onSwipe(e) {\n      const direction = Math.abs(e.deltaX) > 40 ? e.deltaX > 0 ? 1 : 2 : 0;\n\n      if (direction === 2) {\n        this.playerService.onNext();\n      }\n\n      if (direction === 1) {\n        this.playerService.onPrev();\n      }\n    }\n\n    onQueue() {\n      this.bottomSheet.toggle();\n      this.virtualScroll.scrollToIndex(this.playerService.index);\n    }\n\n    ngOnDestroy() {\n      this.destroy.next();\n    }\n\n  }\n\n  NowPlayingComponent.ɵfac = function NowPlayingComponent_Factory(t) {\n    return new (t || NowPlayingComponent)(i0.ɵɵdirectiveInject(i1.PlayerService), i0.ɵɵdirectiveInject(i2.Location), i0.ɵɵdirectiveInject(i3.Router));\n  };\n\n  NowPlayingComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: NowPlayingComponent,\n    selectors: [[\"app-now-playing\"]],\n    viewQuery: function NowPlayingComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n        i0.ɵɵviewQuery(_c2, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.swiper = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.bottomSheet = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.virtualScroll = _t.first);\n      }\n    },\n    decls: 3,\n    vars: 1,\n    consts: [[3, \"back\"], [1, \"container\", \"mx-auto\"], [1, \"playing\"]],\n    template: function NowPlayingComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-header\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelement(2, \"div\", 2);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"back\", true);\n      }\n    },\n    directives: [i4.HeaderComponent],\n    styles: [\"[_nghost-%COMP%]{overflow:auto;display:block;height:100vh;background:var(--background-color)}.playing[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:calc(100vh - (env(safe-area-inset-bottom) + env(safe-area-inset-top)));overflow:auto;background:var(--background-color);width:100%;color:var(--foreground-color)}.playing-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px}.playing-header.queue[_ngcontent-%COMP%]{border:1px solid var(--border-color);padding:10px;margin:15px;border-radius:5px}.playing-header.queue[_ngcontent-%COMP%]   .playing-header-action[_ngcontent-%COMP%]{padding:5px}.playing-header.queue[_ngcontent-%COMP%]   .playing-header-action-item[_ngcontent-%COMP%]{font-size:1rem!important}.playing-header-action-item[_ngcontent-%COMP%]{text-align:center;font-size:1.4rem}.playing-header-playing[_ngcontent-%COMP%]{text-align:center;flex-grow:1}.playing-header-playing[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:800;font-family:Open Sans,sans-serif;text-transform:uppercase}.playing-header-playing[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{opacity:.5;font-size:13px}.playing-section[_ngcontent-%COMP%]{background:blue;flex-grow:1;display:flex;flex-direction:row}.playing-carousel[_ngcontent-%COMP%]{padding:0 15px;flex-grow:1;flex-basis:0;display:flex}.playing-carousel[_ngcontent-%COMP%]   .image-wrap[_ngcontent-%COMP%]{flex-grow:1;display:flex;padding:15px;overflow:hidden;position:relative;border-radius:5px;box-shadow:0 2px 4px #0000000f;-o-object-fit:cover;object-fit:cover}.playing-carousel[_ngcontent-%COMP%]   .image-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;left:0;top:0;bottom:0;right:0;border-radius:5px;margin:0 auto;position:absolute;-o-object-fit:cover;object-fit:cover}.playing-track[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:15px 15px 0}.playing-track-details[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;min-width:0;padding-right:15px}.playing-track-details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;overflow:auto;white-space:nowrap;text-overflow:ellipsis}.playing-track-details[_ngcontent-%COMP%]   .artists[_ngcontent-%COMP%]{font-size:13px;opacity:.5;font-weight:500;overflow:auto;white-space:nowrap}.playing-track-actions[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:1.4rem}.playing-track-actions[_ngcontent-%COMP%]   div.active[_ngcontent-%COMP%]{color:var(--accent-color)}.playing-progress[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:15px;position:relative}.playing-progress-slider[_ngcontent-%COMP%]{position:relative}.playing-progress-time[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;padding-top:15px;opacity:.5;font-size:.8rem}.playing-progress-time[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{text-align:left;flex-grow:1;flex-basis:0}.playing-progress-time[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{text-align:right;flex-grow:1;flex-basis:0}.playing-controls[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%}.playing-controls-control[_ngcontent-%COMP%]{text-align:center;display:flex;align-items:center;justify-content:center}.playing-controls-control[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2rem}.playing-controls-control.grow[_ngcontent-%COMP%]{flex-grow:1}.playing-controls-control.grow[_ngcontent-%COMP%]   .skip[_ngcontent-%COMP%]{border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center}.playing-controls-control.grow[_ngcontent-%COMP%]   .skip[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2rem}.playing-controls-control.grow[_ngcontent-%COMP%]   .skip.disabled[_ngcontent-%COMP%]{cursor:disabled;opacity:.2}.playing-controls-control.grow[_ngcontent-%COMP%]   .playback[_ngcontent-%COMP%]{background-color:var(--background-color-3);height:60px;width:60px;border-radius:50%;display:flex;align-items:center;justify-content:center}.playing-controls-control.grow[_ngcontent-%COMP%]   .playback[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2.5rem}.playing-controls-control.repeat[_ngcontent-%COMP%], .playing-controls-control.shuffle[_ngcontent-%COMP%]{opacity:.6;margin-left:15px;margin-right:15px}.playing-controls-control.repeat[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .playing-controls-control.shuffle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem}.playing-controls-control.active[_ngcontent-%COMP%]{color:var(--accent-color)}.playing-volume[_ngcontent-%COMP%]{display:flex;flex-direction:row;min-width:0px}.playing-volume-controls[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:15px;flex-grow:1;position:relative}.playing-volume-controls-level[_ngcontent-%COMP%]{opacity:.6;padding-right:15px;font-size:1.2rem}.playing-volume-controls-slider[_ngcontent-%COMP%]{position:relative;flex-grow:1}.playing-queue[_ngcontent-%COMP%]{display:flex;align-items:flex-end;width:100%;padding-top:15px}.playing-queue-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px;flex-grow:1;background:var(--background-color-2);margin:15px;border-radius:20px}.playing-queue-header[_ngcontent-%COMP%]   .playing-header-action[_ngcontent-%COMP%]{padding:5px}.playing-queue-header[_ngcontent-%COMP%]   .playing-header-action-item[_ngcontent-%COMP%]{font-size:1rem!important}.playing-queue-header-action-item[_ngcontent-%COMP%]{text-align:center;font-size:1.4rem}.playing-queue-header-playing[_ngcontent-%COMP%]{text-align:center;flex-grow:1}.playing-queue-header-playing[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:600}.playing-queue-header-playing[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{opacity:.5;font-size:13px}.playing-queue-handle[_ngcontent-%COMP%]{background-color:var(--foreground-color);opacity:.2;height:10px;width:10%;margin:0 auto;border-radius:20px}virtual-scroller[_ngcontent-%COMP%]{width:100%;height:80vh;padding-bottom:env(safe-area-inset-bottom)}@-webkit-keyframes move{0%{transform-origin:top left;transform:scale(1)}to{transform:scale(1.2)}}@keyframes move{0%{transform-origin:top left;transform:scale(1)}to{transform:scale(1.2)}}@media all and (max-width: 1000px){.playing-volume[_ngcontent-%COMP%]{display:none}}\"]\n  });\n  return NowPlayingComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}